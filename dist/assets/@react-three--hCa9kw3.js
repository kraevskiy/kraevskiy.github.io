import{_ as Z}from"./@babel-dGVwEr9R.js";import{r as m}from"./react-vLfDI-hP.js";import{L as Se,T as $t,R as Bt,U as Nt,a as Gt,O as Be,P as Ne,S as Qe,b as xe,N as Ut,A as qt,B as Vt,M as Xt,C as Yt,V as q,c as Zt,W as Kt,d as Jt,e as Qt,f as er,g as tr,h as rr,i as nr,D as or,j as we,k as Ge,l as ir,m as sr,E as dt,n as ar,o as lr,p as cr,q as ce,r as ur,s as fr,t as dr}from"./three-8LitQ1sK.js";import{u as pr}from"./react-use-measure-xU8ZMe27.js";import{F as mr,u as vr}from"./its-fine-gZbu039Z.js";import{R as hr,c as le}from"./react-reconciler-bONRjlPd.js";import{c as gr}from"./react-dom-c0eK0vv5.js";import{c as pt}from"./zustand-gI0ArxUt.js";import{D as yr,G as Ue,a as br,M as Re,O as wr}from"./three-stdlib-fk37-F48.js";import{m as qe}from"./react-merge-refs-hAbx5P3g.js";import{s as _r,p as Er,c as Pr}from"./suspend-react-7rE_FwbT.js";function wn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function _n(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var a=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,a.get?a:{enumerable:!0,get:function(){return e[i]}})}),r}var mt={exports:{}},vt={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(w,x){var S=w.length;w.push(x);e:for(;0<S;){var T=S-1>>>1,R=w[T];if(0<a(R,x))w[T]=x,w[S]=R,S=T;else break e}}function r(w){return w.length===0?null:w[0]}function i(w){if(w.length===0)return null;var x=w[0],S=w.pop();if(S!==x){w[0]=S;e:for(var T=0,R=w.length,j=R>>>1;T<j;){var B=2*(T+1)-1,F=w[B],V=B+1,K=w[V];if(0>a(F,S))V<R&&0>a(K,F)?(w[T]=K,w[V]=S,T=V):(w[T]=F,w[B]=S,T=B);else if(V<R&&0>a(K,S))w[T]=K,w[V]=S,T=V;else break e}}return x}function a(w,x){var S=w.sortIndex-x.sortIndex;return S!==0?S:w.id-x.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var h=Date,v=h.now();e.unstable_now=function(){return h.now()-v}}var s=[],g=[],n=1,o=null,u=3,d=!1,p=!1,P=!1,y=typeof setTimeout=="function"?setTimeout:null,c=typeof clearTimeout=="function"?clearTimeout:null,f=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(w){for(var x=r(g);x!==null;){if(x.callback===null)i(g);else if(x.startTime<=w)i(g),x.sortIndex=x.expirationTime,t(s,x);else break;x=r(g)}}function C(w){if(P=!1,b(w),!p)if(r(s)!==null)p=!0,N(M);else{var x=r(g);x!==null&&H(C,x.startTime-w)}}function M(w,x){p=!1,P&&(P=!1,c(k),k=-1),d=!0;var S=u;try{for(b(x),o=r(s);o!==null&&(!(o.expirationTime>x)||w&&!_());){var T=o.callback;if(typeof T=="function"){o.callback=null,u=o.priorityLevel;var R=T(o.expirationTime<=x);x=e.unstable_now(),typeof R=="function"?o.callback=R:o===r(s)&&i(s),b(x)}else i(s);o=r(s)}if(o!==null)var j=!0;else{var B=r(g);B!==null&&H(C,B.startTime-x),j=!1}return j}finally{o=null,u=S,d=!1}}var E=!1,A=null,k=-1,O=5,L=-1;function _(){return!(e.unstable_now()-L<O)}function D(){if(A!==null){var w=e.unstable_now();L=w;var x=!0;try{x=A(!0,w)}finally{x?$():(E=!1,A=null)}}else E=!1}var $;if(typeof f=="function")$=function(){f(D)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,W=X.port2;X.port1.onmessage=D,$=function(){W.postMessage(null)}}else $=function(){y(D,0)};function N(w){A=w,E||(E=!0,$())}function H(w,x){k=y(function(){w(e.unstable_now())},x)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(w){w.callback=null},e.unstable_continueExecution=function(){p||d||(p=!0,N(M))},e.unstable_forceFrameRate=function(w){0>w||125<w?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<w?Math.floor(1e3/w):5},e.unstable_getCurrentPriorityLevel=function(){return u},e.unstable_getFirstCallbackNode=function(){return r(s)},e.unstable_next=function(w){switch(u){case 1:case 2:case 3:var x=3;break;default:x=u}var S=u;u=x;try{return w()}finally{u=S}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(w,x){switch(w){case 1:case 2:case 3:case 4:case 5:break;default:w=3}var S=u;u=w;try{return x()}finally{u=S}},e.unstable_scheduleCallback=function(w,x,S){var T=e.unstable_now();switch(typeof S=="object"&&S!==null?(S=S.delay,S=typeof S=="number"&&0<S?T+S:T):S=T,w){case 1:var R=-1;break;case 2:R=250;break;case 5:R=1073741823;break;case 4:R=1e4;break;default:R=5e3}return R=S+R,w={id:n++,callback:x,priorityLevel:w,startTime:S,expirationTime:R,sortIndex:-1},S>T?(w.sortIndex=S,t(g,w),r(s)===null&&w===r(g)&&(P?(c(k),k=-1):P=!0,H(C,S-T))):(w.sortIndex=R,t(s,w),p||d||(p=!0,N(M))),w},e.unstable_shouldYield=_,e.unstable_wrapCallback=function(w){var x=u;return function(){var S=u;u=x;try{return w.apply(this,arguments)}finally{u=S}}}})(vt);mt.exports=vt;var et=mt.exports;const Ve={},Mr=e=>void Object.assign(Ve,e);function Cr(e,t){function r(n,{args:o=[],attach:u,...d},p){let P=`${n[0].toUpperCase()}${n.slice(1)}`,y;if(n==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const c=d.object;y=se(c,{type:n,root:p,attach:u,primitive:!0})}else{const c=Ve[P];if(!c)throw new Error(`R3F: ${P} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");y=se(new c(...o),{type:n,root:p,attach:u,memoizedProps:{args:o}})}return y.__r3f.attach===void 0&&(y instanceof Vt?y.__r3f.attach="geometry":y instanceof Xt&&(y.__r3f.attach="material")),P!=="inject"&&Ae(y,d),y}function i(n,o){let u=!1;if(o){var d,p;(d=o.__r3f)!=null&&d.attach?Te(n,o,o.__r3f.attach):o.isObject3D&&n.isObject3D&&(n.add(o),u=!0),u||(p=n.__r3f)==null||p.objects.push(o),o.__r3f||se(o,{}),o.__r3f.parent=n,He(o),ae(o)}}function a(n,o,u){let d=!1;if(o){var p,P;if((p=o.__r3f)!=null&&p.attach)Te(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){o.parent=n,o.dispatchEvent({type:"added"});const y=n.children.filter(f=>f!==o),c=y.indexOf(u);n.children=[...y.slice(0,c),o,...y.slice(c)],d=!0}d||(P=n.__r3f)==null||P.objects.push(o),o.__r3f||se(o,{}),o.__r3f.parent=n,He(o),ae(o)}}function l(n,o,u=!1){n&&[...n].forEach(d=>h(o,d,u))}function h(n,o,u){if(o){var d,p,P;if(o.__r3f&&(o.__r3f.parent=null),(d=n.__r3f)!=null&&d.objects&&(n.__r3f.objects=n.__r3f.objects.filter(C=>C!==o)),(p=o.__r3f)!=null&&p.attach)it(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){var y;n.remove(o),(y=o.__r3f)!=null&&y.root&&Dr(o.__r3f.root,o)}const f=(P=o.__r3f)==null?void 0:P.primitive,b=!f&&(u===void 0?o.dispose!==null:u);if(!f){var c;l((c=o.__r3f)==null?void 0:c.objects,o,b),l(o.children,o,b)}if(delete o.__r3f,b&&o.dispose&&o.type!=="Scene"){const C=()=>{try{o.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?et.unstable_scheduleCallback(et.unstable_IdlePriority,C):C()}ae(n)}}function v(n,o,u,d){var p;const P=(p=n.__r3f)==null?void 0:p.parent;if(!P)return;const y=r(o,u,n.__r3f.root);if(n.children){for(const c of n.children)c.__r3f&&i(y,c);n.children=n.children.filter(c=>!c.__r3f)}n.__r3f.objects.forEach(c=>i(y,c)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||h(P,n),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),i(P,y),y.raycast&&y.__r3f.eventCount&&y.__r3f.root.getState().internal.interaction.push(y),[d,d.alternate].forEach(c=>{c!==null&&(c.stateNode=y,c.ref&&(typeof c.ref=="function"?c.ref(y):c.ref.current=y))})}const s=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:hr({createInstance:r,removeChild:h,appendChild:i,appendInitialChild:i,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,o)=>{if(!o)return;const u=n.getState().scene;u.__r3f&&(u.__r3f.root=n,i(u,o))},removeChildFromContainer:(n,o)=>{o&&h(n.getState().scene,o)},insertInContainerBefore:(n,o,u)=>{if(!o||!u)return;const d=n.getState().scene;d.__r3f&&a(d,o,u)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var o;return!!((o=n==null?void 0:n.__r3f)!=null?o:{}).handlers},prepareUpdate(n,o,u,d){var p;if(((p=n==null?void 0:n.__r3f)!=null?p:{}).primitive&&d.object&&d.object!==n)return[!0];{const{args:y=[],children:c,...f}=d,{args:b=[],children:C,...M}=u;if(!Array.isArray(y))throw new Error("R3F: the args prop must be an array!");if(y.some((A,k)=>A!==b[k]))return[!0];const E=Et(n,f,M,!0);return E.changes.length?[!1,E]:null}},commitUpdate(n,[o,u],d,p,P,y){o?v(n,d,P,y):Ae(n,u)},commitMount(n,o,u,d){var p;const P=(p=n.__r3f)!=null?p:{};n.raycast&&P.handlers&&P.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>se(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var o;const{attach:u,parent:d}=(o=n.__r3f)!=null?o:{};u&&d&&it(d,n,u),n.isObject3D&&(n.visible=!1),ae(n)},unhideInstance(n,o){var u;const{attach:d,parent:p}=(u=n.__r3f)!=null?u:{};d&&p&&Te(p,n,d),(n.isObject3D&&o.visible==null||o.visible)&&(n.visible=!0),ae(n)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():le.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&I.fun(performance.now)?performance.now:I.fun(Date.now)?Date.now:()=>0,scheduleTimeout:I.fun(setTimeout)?setTimeout:void 0,cancelTimeout:I.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ae}}var tt,rt;const Oe=e=>"colorSpace"in e||"outputColorSpace"in e,ht=()=>{var e;return(e=Ve.ColorManagement)!=null?e:null},gt=e=>e&&e.isOrthographicCamera,Sr=e=>e&&e.hasOwnProperty("current"),he=typeof window<"u"&&((tt=window.document)!=null&&tt.createElement||((rt=window.navigator)==null?void 0:rt.product)==="ReactNative")?m.useLayoutEffect:m.useEffect;function yt(e){const t=m.useRef(e);return he(()=>void(t.current=e),[e]),t}function xr({set:e}){return he(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class bt extends m.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}bt.getDerivedStateFromError=()=>({error:!0});const wt="__default",nt=new Map,Rr=e=>e&&!!e.memoized&&!!e.changes;function _t(e){var t;const r=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],r),e[1]):e}const de=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},I={obj:e=>e===Object(e)&&!I.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:a=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(I.str(e)||I.num(e))return e===t;const l=I.obj(e);if(l&&i==="reference")return e===t;const h=I.arr(e);if(h&&r==="reference")return e===t;if((h||l)&&e===t)return!0;let v;for(v in e)if(!(v in t))return!1;if(l&&r==="shallow"&&i==="shallow"){for(v in a?t:e)if(!I.equ(e[v],t[v],{strict:a,objects:"reference"}))return!1}else for(v in a?t:e)if(e[v]!==t[v])return!1;if(I.und(v)){if(h&&e.length===0&&t.length===0||l&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Or(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function Tr(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function se(e,t){const r=e;return r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function We(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),a=i.pop();return r=i.reduce((l,h)=>l[h],e),{target:r,key:a}}else return{target:r,key:t}}const ot=/-\d+$/;function Te(e,t,r){if(I.str(r)){if(ot.test(r)){const l=r.replace(ot,""),{target:h,key:v}=We(e,l);Array.isArray(h[v])||(h[v]=[])}const{target:i,key:a}=We(e,r);t.__r3f.previousAttach=i[a],i[a]=t}else t.__r3f.previousAttach=r(e,t)}function it(e,t,r){var i,a;if(I.str(r)){const{target:l,key:h}=We(e,r),v=t.__r3f.previousAttach;v===void 0?delete l[h]:l[h]=v}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(a=t.__r3f)==null||delete a.previousAttach}function Et(e,{children:t,key:r,ref:i,...a},{children:l,key:h,ref:v,...s}={},g=!1){var n;const o=(n=e==null?void 0:e.__r3f)!=null?n:{},u=Object.entries(a),d=[];if(g){const P=Object.keys(s);for(let y=0;y<P.length;y++)a.hasOwnProperty(P[y])||u.unshift([P[y],wt+"remove"])}u.forEach(([P,y])=>{var c;if((c=e.__r3f)!=null&&c.primitive&&P==="object"||I.equ(y,s[P]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(P))return d.push([P,y,!0,[]]);let f=[];P.includes("-")&&(f=P.split("-")),d.push([P,y,!1,f]);for(const b in a){const C=a[b];b.startsWith(`${P}-`)&&d.push([b,C,!1,b.split("-")])}});const p={...a};return o.memoizedProps&&o.memoizedProps.args&&(p.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(p.attach=o.memoizedProps.attach),{memoized:p,changes:d}}const Ar=typeof process<"u"&&!1;function Ae(e,t){var r,i,a;const l=(r=e.__r3f)!=null?r:{},h=l.root,v=(i=h==null||h.getState==null?void 0:h.getState())!=null?i:{},{memoized:s,changes:g}=Rr(t)?t:Et(e,t),n=l.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let u=0;u<g.length;u++){let[d,p,P,y]=g[u];if(Oe(e)){const C="srgb",M="srgb-linear";d==="encoding"?(d="colorSpace",p=p===3001?C:M):d==="outputEncoding"&&(d="outputColorSpace",p=p===3001?C:M)}let c=e,f=c[d];if(y.length&&(f=y.reduce((b,C)=>b[C],e),!(f&&f.set))){const[b,...C]=y.reverse();c=C.reverse().reduce((M,E)=>M[E],e),d=b}if(p===wt+"remove")if(c.constructor){let b=nt.get(c.constructor);b||(b=new c.constructor,nt.set(c.constructor,b)),p=b[d]}else p=0;if(P)p?l.handlers[d]=p:delete l.handlers[d],l.eventCount=Object.keys(l.handlers).length;else if(f&&f.set&&(f.copy||f instanceof Se)){if(Array.isArray(p))f.fromArray?f.fromArray(p):f.set(...p);else if(f.copy&&p&&p.constructor&&(Ar?f.constructor.name===p.constructor.name:f.constructor===p.constructor))f.copy(p);else if(p!==void 0){const b=f instanceof Yt;!b&&f.setScalar?f.setScalar(p):f instanceof Se&&p instanceof Se?f.mask=p.mask:f.set(p),!ht()&&!v.linear&&b&&f.convertSRGBToLinear()}}else if(c[d]=p,c[d]instanceof $t&&c[d].format===Bt&&c[d].type===Nt){const b=c[d];Oe(b)&&Oe(v.gl)?b.colorSpace=v.gl.outputColorSpace:b.encoding=v.gl.outputEncoding}ae(e)}if(l.parent&&v.internal&&e.raycast&&n!==l.eventCount){const u=v.internal.interaction.indexOf(e);u>-1&&v.internal.interaction.splice(u,1),l.eventCount&&v.internal.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(a=e.__r3f)!=null&&a.parent&&He(e),e}function ae(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function He(e){e.onUpdate==null||e.onUpdate(e)}function jr(e,t){e.manual||(gt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function _e(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function kr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return le.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return le.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return le.ContinuousEventPriority;default:return le.DefaultEventPriority}}function Pt(e,t,r,i){const a=r.get(t);a&&(r.delete(t),r.size===0&&(e.delete(i),a.target.releasePointerCapture(i)))}function Dr(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,a)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(a)}),r.capturedMap.forEach((i,a)=>{Pt(r.capturedMap,t,i,a)})}function Lr(e){function t(s){const{internal:g}=e.getState(),n=s.offsetX-g.initialClick[0],o=s.offsetY-g.initialClick[1];return Math.round(Math.sqrt(n*n+o*o))}function r(s){return s.filter(g=>["Move","Over","Enter","Out","Leave"].some(n=>{var o;return(o=g.__r3f)==null?void 0:o.handlers["onPointer"+n]}))}function i(s,g){const n=e.getState(),o=new Set,u=[],d=g?g(n.internal.interaction):n.internal.interaction;for(let c=0;c<d.length;c++){const f=de(d[c]);f&&(f.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(s,n);function p(c){const f=de(c);if(!f||!f.events.enabled||f.raycaster.camera===null)return[];if(f.raycaster.camera===void 0){var b;f.events.compute==null||f.events.compute(s,f,(b=f.previousRoot)==null?void 0:b.getState()),f.raycaster.camera===void 0&&(f.raycaster.camera=null)}return f.raycaster.camera?f.raycaster.intersectObject(c,!0):[]}let P=d.flatMap(p).sort((c,f)=>{const b=de(c.object),C=de(f.object);return!b||!C?c.distance-f.distance:C.events.priority-b.events.priority||c.distance-f.distance}).filter(c=>{const f=_e(c);return o.has(f)?!1:(o.add(f),!0)});n.events.filter&&(P=n.events.filter(P,n));for(const c of P){let f=c.object;for(;f;){var y;(y=f.__r3f)!=null&&y.eventCount&&u.push({...c,eventObject:f}),f=f.parent}}if("pointerId"in s&&n.internal.capturedMap.has(s.pointerId))for(let c of n.internal.capturedMap.get(s.pointerId).values())o.has(_e(c.intersection))||u.push(c.intersection);return u}function a(s,g,n,o){const u=e.getState();if(s.length){const d={stopped:!1};for(const p of s){const P=de(p.object)||u,{raycaster:y,pointer:c,camera:f,internal:b}=P,C=new q(c.x,c.y,0).unproject(f),M=L=>{var _,D;return(_=(D=b.capturedMap.get(L))==null?void 0:D.has(p.eventObject))!=null?_:!1},E=L=>{const _={intersection:p,target:g.target};b.capturedMap.has(L)?b.capturedMap.get(L).set(p.eventObject,_):b.capturedMap.set(L,new Map([[p.eventObject,_]])),g.target.setPointerCapture(L)},A=L=>{const _=b.capturedMap.get(L);_&&Pt(b.capturedMap,p.eventObject,_,L)};let k={};for(let L in g){let _=g[L];typeof _!="function"&&(k[L]=_)}let O={...p,...k,pointer:c,intersections:s,stopped:d.stopped,delta:n,unprojectedPoint:C,ray:y.ray,camera:f,stopPropagation(){const L="pointerId"in g&&b.capturedMap.get(g.pointerId);if((!L||L.has(p.eventObject))&&(O.stopped=d.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(_=>_.eventObject===p.eventObject))){const _=s.slice(0,s.indexOf(p));l([..._,p])}},target:{hasPointerCapture:M,setPointerCapture:E,releasePointerCapture:A},currentTarget:{hasPointerCapture:M,setPointerCapture:E,releasePointerCapture:A},nativeEvent:g};if(o(O),d.stopped===!0)break}}return s}function l(s){const{internal:g}=e.getState();for(const n of g.hovered.values())if(!s.length||!s.find(o=>o.object===n.object&&o.index===n.index&&o.instanceId===n.instanceId)){const u=n.eventObject.__r3f,d=u==null?void 0:u.handlers;if(g.hovered.delete(_e(n)),u!=null&&u.eventCount){const p={...n,intersections:s};d.onPointerOut==null||d.onPointerOut(p),d.onPointerLeave==null||d.onPointerLeave(p)}}}function h(s,g){for(let n=0;n<g.length;n++){const o=g[n].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(s)}}function v(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>l([]);case"onLostPointerCapture":return g=>{const{internal:n}=e.getState();"pointerId"in g&&n.capturedMap.has(g.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(g.pointerId)&&(n.capturedMap.delete(g.pointerId),l([]))})}}return function(n){const{onPointerMissed:o,internal:u}=e.getState();u.lastEvent.current=n;const d=s==="onPointerMove",p=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",y=i(n,d?r:void 0),c=p?t(n):0;s==="onPointerDown"&&(u.initialClick=[n.offsetX,n.offsetY],u.initialHits=y.map(b=>b.eventObject)),p&&!y.length&&c<=2&&(h(n,u.interaction),o&&o(n)),d&&l(y);function f(b){const C=b.eventObject,M=C.__r3f,E=M==null?void 0:M.handlers;if(M!=null&&M.eventCount)if(d){if(E.onPointerOver||E.onPointerEnter||E.onPointerOut||E.onPointerLeave){const A=_e(b),k=u.hovered.get(A);k?k.stopped&&b.stopPropagation():(u.hovered.set(A,b),E.onPointerOver==null||E.onPointerOver(b),E.onPointerEnter==null||E.onPointerEnter(b))}E.onPointerMove==null||E.onPointerMove(b)}else{const A=E[s];A?(!p||u.initialHits.includes(C))&&(h(n,u.interaction.filter(k=>!u.initialHits.includes(k))),A(b)):p&&u.initialHits.includes(C)&&h(n,u.interaction.filter(k=>!u.initialHits.includes(k)))}}a(y,n,c,f)}}return{handlePointer:v}}const Mt=e=>!!(e!=null&&e.render),Ct=m.createContext(null),Fr=(e,t)=>{const r=pt((v,s)=>{const g=new q,n=new q,o=new q;function u(c=s().camera,f=n,b=s().size){const{width:C,height:M,top:E,left:A}=b,k=C/M;f instanceof q?o.copy(f):o.set(...f);const O=c.getWorldPosition(g).distanceTo(o);if(gt(c))return{width:C/c.zoom,height:M/c.zoom,top:E,left:A,factor:1,distance:O,aspect:k};{const L=c.fov*Math.PI/180,_=2*Math.tan(L/2)*O,D=_*(C/M);return{width:D,height:_,top:E,left:A,factor:C/D,distance:O,aspect:k}}}let d;const p=c=>v(f=>({performance:{...f.performance,current:c}})),P=new Zt;return{set:v,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(c=1)=>e(s(),c),advance:(c,f)=>t(c,f,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new rr,pointer:P,mouse:P,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const c=s();d&&clearTimeout(d),c.performance.current!==c.performance.min&&p(c.performance.min),d=setTimeout(()=>p(s().performance.max),c.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:u},setEvents:c=>v(f=>({...f,events:{...f.events,...c}})),setSize:(c,f,b,C,M)=>{const E=s().camera,A={width:c,height:f,top:C||0,left:M||0,updateStyle:b};v(k=>({size:A,viewport:{...k.viewport,...u(E,n,A)}}))},setDpr:c=>v(f=>{const b=_t(c);return{viewport:{...f.viewport,dpr:b,initialDpr:f.viewport.initialDpr||b}}}),setFrameloop:(c="always")=>{const f=s().clock;f.stop(),f.elapsedTime=0,c!=="never"&&(f.start(),f.elapsedTime=0),v(()=>({frameloop:c}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:m.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(c,f,b)=>{const C=s().internal;return C.priority=C.priority+(f>0?1:0),C.subscribers.push({ref:c,priority:f,store:b}),C.subscribers=C.subscribers.sort((M,E)=>M.priority-E.priority),()=>{const M=s().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(f>0?1:0),M.subscribers=M.subscribers.filter(E=>E.ref!==c))}}}}}),i=r.getState();let a=i.size,l=i.viewport.dpr,h=i.camera;return r.subscribe(()=>{const{camera:v,size:s,viewport:g,gl:n,set:o}=r.getState();if(s.width!==a.width||s.height!==a.height||g.dpr!==l){var u;a=s,l=g.dpr,jr(v,s),n.setPixelRatio(g.dpr);const d=(u=s.updateStyle)!=null?u:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(s.width,s.height,d)}v!==h&&(h=v,o(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(v)}})))}),r.subscribe(v=>e(v)),r};let Ee,zr=new Set,Ir=new Set,Wr=new Set;function je(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function pe(e,t){switch(e){case"before":return je(zr,t);case"after":return je(Ir,t);case"tail":return je(Wr,t)}}let ke,De;function Le(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),ke=t.internal.subscribers,Ee=0;Ee<ke.length;Ee++)De=ke[Ee],De.ref.current(De.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Hr(e){let t=!1,r,i,a;function l(s){i=requestAnimationFrame(l),t=!0,r=0,pe("before",s);for(const n of e.values()){var g;a=n.store.getState(),a.internal.active&&(a.frameloop==="always"||a.internal.frames>0)&&!((g=a.gl.xr)!=null&&g.isPresenting)&&(r+=Le(s,a))}if(pe("after",s),r===0)return pe("tail",s),t=!1,cancelAnimationFrame(i)}function h(s,g=1){var n;if(!s)return e.forEach(o=>h(o.store.getState()),g);(n=s.gl.xr)!=null&&n.isPresenting||!s.internal.active||s.frameloop==="never"||(s.internal.frames=Math.min(60,s.internal.frames+g),t||(t=!0,requestAnimationFrame(l)))}function v(s,g=!0,n,o){if(g&&pe("before",s),n)Le(s,n,o);else for(const u of e.values())Le(s,u.store.getState());g&&pe("after",s)}return{loop:l,invalidate:h,advance:v}}function St(){const e=m.useContext(Ct);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function U(e=r=>r,t){return St()(e,t)}function ge(e,t=0){const r=St(),i=r.getState().internal.subscribe,a=yt(e);return he(()=>i(a,t,r),[t,i,r]),null}const st=new WeakMap;function xt(e,t){return function(r,...i){let a=st.get(r);return a||(a=new r,st.set(r,a)),e&&e(a),Promise.all(i.map(l=>new Promise((h,v)=>a.load(l,s=>{s.scene&&Object.assign(s,Or(s.scene)),h(s)},t,s=>v(new Error(`Could not load ${l}: ${s==null?void 0:s.message}`)))))).finally(()=>a.dispose==null?void 0:a.dispose())}}function Q(e,t,r,i){const a=Array.isArray(t)?t:[t],l=_r(xt(r,i),[e,...a],{equal:I.equ});return Array.isArray(t)?l:l[0]}Q.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return Er(xt(r),[e,...i])};Q.clear=function(e,t){const r=Array.isArray(t)?t:[t];return Pr([e,...r])};const ue=new Map,{invalidate:at,advance:lt}=Hr(ue),{reconciler:Me,applyProps:Y}=Cr(ue,kr),ie={objects:"shallow",strict:!1},$r=(e,t)=>{const r=typeof e=="function"?e(t):e;return Mt(r)?r:new Kt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Br(e,t){const r=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:a,top:l,left:h,updateStyle:v=r}=t;return{width:i,height:a,top:l,left:h,updateStyle:v}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:a,top:l,left:h}=e.parentElement.getBoundingClientRect();return{width:i,height:a,top:l,left:h,updateStyle:r}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:r};return{width:0,height:0,top:0,left:0}}function Nr(e){const t=ue.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,l=i||Fr(at,lt),h=r||Me.createContainer(l,le.ConcurrentRoot,null,!1,null,"",a,null);t||ue.set(e,{fiber:h,store:l});let v,s=!1,g;return{configure(n={}){let{gl:o,size:u,scene:d,events:p,onCreated:P,shadows:y=!1,linear:c=!1,flat:f=!1,legacy:b=!1,orthographic:C=!1,frameloop:M="always",dpr:E=[1,2],performance:A,raycaster:k,camera:O,onPointerMissed:L}=n,_=l.getState(),D=_.gl;_.gl||_.set({gl:D=$r(o,e)});let $=_.raycaster;$||_.set({raycaster:$=new Gt});const{params:X,...W}=k||{};if(I.equ(W,$,ie)||Y($,{...W}),I.equ(X,$.params,ie)||Y($,{params:{...$.params,...X}}),!_.camera||_.camera===g&&!I.equ(g,O,ie)){g=O;const R=O instanceof Jt,j=R?O:C?new Be(0,0,0,0,.1,1e3):new Ne(75,0,.1,1e3);R||(j.position.z=5,O&&Y(j,O),!_.camera&&!(O!=null&&O.rotation)&&j.lookAt(0,0,0)),_.set({camera:j}),$.camera=j}if(!_.scene){let R;d instanceof Qe?R=d:(R=new Qe,d&&Y(R,d)),_.set({scene:se(R)})}if(!_.xr){var N;const R=(F,V)=>{const K=l.getState();K.frameloop!=="never"&&lt(F,!0,K,V)},j=()=>{const F=l.getState();F.gl.xr.enabled=F.gl.xr.isPresenting,F.gl.xr.setAnimationLoop(F.gl.xr.isPresenting?R:null),F.gl.xr.isPresenting||at(F)},B={connect(){const F=l.getState().gl;F.xr.addEventListener("sessionstart",j),F.xr.addEventListener("sessionend",j)},disconnect(){const F=l.getState().gl;F.xr.removeEventListener("sessionstart",j),F.xr.removeEventListener("sessionend",j)}};typeof((N=D.xr)==null?void 0:N.addEventListener)=="function"&&B.connect(),_.set({xr:B})}if(D.shadowMap){const R=D.shadowMap.enabled,j=D.shadowMap.type;if(D.shadowMap.enabled=!!y,I.boo(y))D.shadowMap.type=xe;else if(I.str(y)){var H;const B={basic:Qt,percentage:er,soft:xe,variance:tr};D.shadowMap.type=(H=B[y])!=null?H:xe}else I.obj(y)&&Object.assign(D.shadowMap,y);(R!==D.shadowMap.enabled||j!==D.shadowMap.type)&&(D.shadowMap.needsUpdate=!0)}const w=ht();w&&("enabled"in w?w.enabled=!b:"legacyMode"in w&&(w.legacyMode=b)),Y(D,{outputEncoding:c?3e3:3001,toneMapping:f?Ut:qt}),_.legacy!==b&&_.set(()=>({legacy:b})),_.linear!==c&&_.set(()=>({linear:c})),_.flat!==f&&_.set(()=>({flat:f})),o&&!I.fun(o)&&!Mt(o)&&!I.equ(o,D,ie)&&Y(D,o),p&&!_.events.handlers&&_.set({events:p(l)});const T=Br(e,u);return I.equ(T,_.size,ie)||_.setSize(T.width,T.height,T.updateStyle,T.top,T.left),E&&_.viewport.dpr!==_t(E)&&_.setDpr(E),_.frameloop!==M&&_.setFrameloop(M),_.onPointerMissed||_.set({onPointerMissed:L}),A&&!I.equ(A,_.performance,ie)&&_.set(R=>({performance:{...R.performance,...A}})),v=P,s=!0,this},render(n){return s||this.configure(),Me.updateContainer(m.createElement(Gr,{store:l,children:n,onCreated:v,rootElement:e}),h,null,()=>{}),l},unmount(){Rt(e)}}}function Gr({store:e,children:t,onCreated:r,rootElement:i}){return he(()=>{const a=e.getState();a.set(l=>({internal:{...l.internal,active:!0}})),r&&r(a),e.getState().events.connected||a.events.connect==null||a.events.connect(i)},[]),m.createElement(Ct.Provider,{value:e},t)}function Rt(e,t){const r=ue.get(e),i=r==null?void 0:r.fiber;if(i){const a=r==null?void 0:r.store.getState();a&&(a.internal.active=!1),Me.updateContainer(null,i,null,()=>{a&&setTimeout(()=>{try{var l,h,v,s;a.events.disconnect==null||a.events.disconnect(),(l=a.gl)==null||(h=l.renderLists)==null||h.dispose==null||h.dispose(),(v=a.gl)==null||v.forceContextLoss==null||v.forceContextLoss(),(s=a.gl)!=null&&s.xr&&a.xr.disconnect(),Tr(a),ue.delete(e),t&&t(e)}catch{}},500)})}}Me.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:m.version});const Fe={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Ur(e){const{handlePointer:t}=Lr(e);return{priority:1,enabled:!0,compute(r,i,a){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Fe).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:a}=e.getState();(r=a.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(a.lastEvent.current)},connect:r=>{var i;const{set:a,events:l}=e.getState();l.disconnect==null||l.disconnect(),a(h=>({events:{...h.events,connected:r}})),Object.entries((i=l.handlers)!=null?i:[]).forEach(([h,v])=>{const[s,g]=Fe[h];r.addEventListener(s,v,{passive:g})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var a;Object.entries((a=i.handlers)!=null?a:[]).forEach(([l,h])=>{if(i&&i.connected instanceof HTMLElement){const[v]=Fe[l];i.connected.removeEventListener(v,h)}}),r(l=>({events:{...l.events,connected:void 0}}))}}}}const qr=m.forwardRef(function({children:t,fallback:r,resize:i,style:a,gl:l,events:h=Ur,eventSource:v,eventPrefix:s,shadows:g,linear:n,flat:o,legacy:u,orthographic:d,frameloop:p,dpr:P,performance:y,raycaster:c,camera:f,scene:b,onPointerMissed:C,onCreated:M,...E},A){m.useMemo(()=>Mr(nr),[]);const k=vr(),[O,L]=pr({scroll:!0,debounce:{scroll:50,resize:0},...i}),_=m.useRef(null),D=m.useRef(null);m.useImperativeHandle(A,()=>_.current);const $=yt(C),[X,W]=m.useState(!1),[N,H]=m.useState(!1);if(X)throw X;if(N)throw N;const w=m.useRef(null);he(()=>{const S=_.current;L.width>0&&L.height>0&&S&&(w.current||(w.current=Nr(S)),w.current.configure({gl:l,events:h,shadows:g,linear:n,flat:o,legacy:u,orthographic:d,frameloop:p,dpr:P,performance:y,raycaster:c,camera:f,scene:b,size:L,onPointerMissed:(...T)=>$.current==null?void 0:$.current(...T),onCreated:T=>{T.events.connect==null||T.events.connect(v?Sr(v)?v.current:v:D.current),s&&T.setEvents({compute:(R,j)=>{const B=R[s+"X"],F=R[s+"Y"];j.pointer.set(B/j.size.width*2-1,-(F/j.size.height)*2+1),j.raycaster.setFromCamera(j.pointer,j.camera)}}),M==null||M(T)}}),w.current.render(m.createElement(k,null,m.createElement(bt,{set:H},m.createElement(m.Suspense,{fallback:m.createElement(xr,{set:W})},t)))))}),m.useEffect(()=>{const S=_.current;if(S)return()=>Rt(S)},[]);const x=v?"none":"auto";return m.createElement("div",Z({ref:D,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:x,...a}},E),m.createElement("div",{ref:O,style:{width:"100%",height:"100%"}},m.createElement("canvas",{ref:_,style:{display:"block"}},r)))}),En=m.forwardRef(function(t,r){return m.createElement(mr,null,m.createElement(qr,Z({},t,{ref:r})))}),ye=new q,Xe=new q,Vr=new q;function Xr(e,t,r){const i=ye.setFromMatrixPosition(e.matrixWorld);i.project(t);const a=r.width/2,l=r.height/2;return[i.x*a+a,-(i.y*l)+l]}function Yr(e,t){const r=ye.setFromMatrixPosition(e.matrixWorld),i=Xe.setFromMatrixPosition(t.matrixWorld),a=r.sub(i),l=t.getWorldDirection(Vr);return a.angleTo(l)>Math.PI/2}function Zr(e,t,r,i){const a=ye.setFromMatrixPosition(e.matrixWorld),l=a.clone();l.project(t),r.setFromCamera(l,t);const h=r.intersectObjects(i,!0);if(h.length){const v=h[0].distance;return a.distanceTo(r.ray.origin)<v}return!0}function Kr(e,t){if(t instanceof Be)return t.zoom;if(t instanceof Ne){const r=ye.setFromMatrixPosition(e.matrixWorld),i=Xe.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,l=r.distanceTo(i);return 1/(2*Math.tan(a/2)*l)}else return 1}function Jr(e,t,r){if(t instanceof Ne||t instanceof Be){const i=ye.setFromMatrixPosition(e.matrixWorld),a=Xe.setFromMatrixPosition(t.matrixWorld),l=i.distanceTo(a),h=(r[1]-r[0])/(t.far-t.near),v=r[1]-h*t.far;return Math.round(h*l+v)}}const $e=e=>Math.abs(e)<1e-10?0:e;function Ot(e,t,r=""){let i="matrix3d(";for(let a=0;a!==16;a++)i+=$e(t[a]*e.elements[a])+(a!==15?",":")");return r+i}const Qr=(e=>t=>Ot(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),en=(e=>(t,r)=>Ot(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function tn(e){return e&&typeof e=="object"&&"current"in e}const Pn=m.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:a,center:l,fullscreen:h,portal:v,distanceFactor:s,sprite:g=!1,transform:n=!1,occlude:o,onOcclude:u,castShadow:d,receiveShadow:p,material:P,geometry:y,zIndexRange:c=[16777271,0],calculatePosition:f=Xr,as:b="div",wrapperClass:C,pointerEvents:M="auto",...E},A)=>{const{gl:k,camera:O,scene:L,size:_,raycaster:D,events:$,viewport:X}=U(),[W]=m.useState(()=>document.createElement(b)),N=m.useRef(),H=m.useRef(null),w=m.useRef(0),x=m.useRef([0,0]),S=m.useRef(null),T=m.useRef(null),R=(v==null?void 0:v.current)||$.connected||k.domElement.parentNode,j=m.useRef(null),B=m.useRef(!1),F=m.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&tn(o[0]),[o]);m.useLayoutEffect(()=>{const G=k.domElement;o&&o==="blending"?(G.style.zIndex=`${Math.floor(c[0]/2)}`,G.style.position="absolute",G.style.pointerEvents="none"):(G.style.zIndex=null,G.style.position=null,G.style.pointerEvents=null)},[o]),m.useLayoutEffect(()=>{if(H.current){const G=N.current=gr(W);if(L.updateMatrixWorld(),n)W.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const z=f(H.current,O,_);W.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${z[0]}px,${z[1]}px,0);transform-origin:0 0;`}return R&&(a?R.prepend(W):R.appendChild(W)),()=>{R&&R.removeChild(W),G.unmount()}}},[R,n]),m.useLayoutEffect(()=>{C&&(W.className=C)},[C]);const V=m.useMemo(()=>n?{position:"absolute",top:0,left:0,width:_.width,height:_.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:l?"translate3d(-50%,-50%,0)":"none",...h&&{top:-_.height/2,left:-_.width/2,width:_.width,height:_.height},...r},[r,l,h,_,n]),K=m.useMemo(()=>({position:"absolute",pointerEvents:M}),[M]);m.useLayoutEffect(()=>{if(B.current=!1,n){var G;(G=N.current)==null||G.render(m.createElement("div",{ref:S,style:V},m.createElement("div",{ref:T,style:K},m.createElement("div",{ref:A,className:i,style:r,children:e}))))}else{var z;(z=N.current)==null||z.render(m.createElement("div",{ref:A,style:V,className:i,children:e}))}});const oe=m.useRef(!0);ge(G=>{if(H.current){O.updateMatrixWorld(),H.current.updateWorldMatrix(!0,!1);const z=n?x.current:f(H.current,O,_);if(n||Math.abs(w.current-O.zoom)>t||Math.abs(x.current[0]-z[0])>t||Math.abs(x.current[1]-z[1])>t){const ee=Yr(H.current,O);let J=!1;F&&(Array.isArray(o)?J=o.map(te=>te.current):o!=="blending"&&(J=[L]));const fe=oe.current;if(J){const te=Zr(H.current,O,D,J);oe.current=te&&!ee}else oe.current=!ee;fe!==oe.current&&(u?u(!oe.current):W.style.display=oe.current?"block":"none");const be=Math.floor(c[0]/2),Dt=o?F?[c[0],be]:[be-1,0]:c;if(W.style.zIndex=`${Jr(H.current,O,Dt)}`,n){const[te,Ke]=[_.width/2,_.height/2],Ce=O.projectionMatrix.elements[5]*Ke,{isOrthographicCamera:Je,top:Lt,left:Ft,bottom:zt,right:It}=O,Wt=Qr(O.matrixWorldInverse),Ht=Je?`scale(${Ce})translate(${$e(-(It+Ft)/2)}px,${$e((Lt+zt)/2)}px)`:`translateZ(${Ce}px)`;let re=H.current.matrixWorld;g&&(re=O.matrixWorldInverse.clone().transpose().copyPosition(re).scale(H.current.scale),re.elements[3]=re.elements[7]=re.elements[11]=0,re.elements[15]=1),W.style.width=_.width+"px",W.style.height=_.height+"px",W.style.perspective=Je?"":`${Ce}px`,S.current&&T.current&&(S.current.style.transform=`${Ht}${Wt}translate(${te}px,${Ke}px)`,T.current.style.transform=en(re,1/((s||10)/400)))}else{const te=s===void 0?1:Kr(H.current,O)*s;W.style.transform=`translate3d(${z[0]}px,${z[1]}px,0) scale(${te})`}x.current=z,w.current=O.zoom}}if(!F&&j.current&&!B.current)if(n){if(S.current){const z=S.current.children[0];if(z!=null&&z.clientWidth&&z!=null&&z.clientHeight){const{isOrthographicCamera:ee}=O;if(ee||y)E.scale&&(Array.isArray(E.scale)?E.scale instanceof q?j.current.scale.copy(E.scale.clone().divideScalar(1)):j.current.scale.set(1/E.scale[0],1/E.scale[1],1/E.scale[2]):j.current.scale.setScalar(1/E.scale));else{const J=(s||10)/400,fe=z.clientWidth*J,be=z.clientHeight*J;j.current.scale.set(fe,be,1)}B.current=!0}}}else{const z=W.children[0];if(z!=null&&z.clientWidth&&z!=null&&z.clientHeight){const ee=1/X.factor,J=z.clientWidth*ee,fe=z.clientHeight*ee;j.current.scale.set(J,fe,1),B.current=!0}j.current.lookAt(G.camera.position)}});const Ze=m.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return m.createElement("group",Z({},E,{ref:H}),o&&!F&&m.createElement("mesh",{castShadow:d,receiveShadow:p,ref:j},y||m.createElement("planeGeometry",null),P||m.createElement("shaderMaterial",{side:or,vertexShader:Ze.vertexShader,fragmentShader:Ze.fragmentShader})))});let me=0;const Mn=pt(e=>(we.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-me)/(i-me)*100})},we.onLoad=()=>{e({active:!1})},we.onError=t=>e(r=>({errors:[...r.errors,t]})),we.onProgress=(t,r,i)=>{r===i&&(me=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-me)/(i-me)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),ct=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Tt(e,t){const r=U(a=>a.gl),i=Q(Ge,ct(e)?Object.values(e):e);if(m.useLayoutEffect(()=>{t==null||t(i)},[t]),m.useEffect(()=>{"initTexture"in r&&(Array.isArray(i)?i:[i]).forEach(r.initTexture)},[r,i]),ct(e)){const a={};let l=0;for(const h in e)a[h]=i[l++];return a}else return i}Tt.preload=e=>Q.preload(Ge,e);Tt.clear=e=>Q.clear(Ge,e);const rn=()=>parseInt(ir.replace(/\D+/g,"")),At=rn();function nn(e){return Array.isArray(e)}function ze(e=[0,0,0]){return nn(e)?e:e instanceof q||e instanceof dt?[e.x,e.y,e.z]:[e,e,e]}const Cn=m.forwardRef(function({debug:t,depthTest:r=!1,polygonOffsetFactor:i=-10,map:a,mesh:l,children:h,position:v,rotation:s,scale:g,...n},o){const u=m.useRef(null);m.useImperativeHandle(o,()=>u.current);const d=m.useRef(null);return m.useLayoutEffect(()=>{const p=(l==null?void 0:l.current)||u.current.parent,P=u.current;if(!(p instanceof sr))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const y={position:new q,rotation:new dt,scale:new q(1,1,1)};if(p){Y(y,{position:v,scale:g});const c=p.matrixWorld.clone();if(p.matrixWorld.identity(),!s||typeof s=="number"){const f=new ar;f.position.copy(y.position),f.lookAt(p.position),typeof s=="number"&&f.rotateZ(s),Y(y,{rotation:f.rotation})}else Y(y,{rotation:s});return P.geometry=new yr(p,y.position,y.rotation,y.scale),d.current&&(Y(d.current,y),d.current.traverse(f=>f.raycast=()=>null)),p.matrixWorld=c,()=>{P.geometry.dispose()}}},[l,...ze(v),...ze(g),...ze(s)]),m.createElement("mesh",Z({ref:u,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":i,"material-depthTest":r,"material-map":a},n),h,t&&m.createElement("mesh",{ref:d},m.createElement("boxGeometry",null),m.createElement("meshNormalMaterial",{wireframe:!0}),m.createElement("axesHelper",null)))});let Pe=null,jt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function kt(e,t,r){return i=>{r&&r(i),e&&(Pe||(Pe=new br),Pe.setDecoderPath(typeof e=="string"?e:jt),i.setDRACOLoader(Pe)),t&&i.setMeshoptDecoder(typeof Re=="function"?Re():Re)}}function Ye(e,t=!0,r=!0,i){return Q(Ue,e,kt(t,r,i))}Ye.preload=(e,t=!0,r=!0,i)=>Q.preload(Ue,e,kt(t,r,i));Ye.clear=e=>Q.clear(Ue,e);Ye.setDecoderPath=e=>{jt=e};const Sn=m.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:a=!0,keyEvents:l=!1,onChange:h,onStart:v,onEnd:s,...g},n)=>{const o=U(E=>E.invalidate),u=U(E=>E.camera),d=U(E=>E.gl),p=U(E=>E.events),P=U(E=>E.setEvents),y=U(E=>E.set),c=U(E=>E.get),f=U(E=>E.performance),b=t||u,C=i||p.connected||d.domElement,M=m.useMemo(()=>new wr(b),[b]);return ge(()=>{M.enabled&&M.update()},-1),m.useEffect(()=>(l&&M.connect(l===!0?C:l),M.connect(C),()=>void M.dispose()),[l,C,r,M,o]),m.useEffect(()=>{const E=O=>{o(),r&&f.regress(),h&&h(O)},A=O=>{v&&v(O)},k=O=>{s&&s(O)};return M.addEventListener("change",E),M.addEventListener("start",A),M.addEventListener("end",k),()=>{M.removeEventListener("start",A),M.removeEventListener("end",k),M.removeEventListener("change",E)}},[h,v,s,M,o,P]),m.useEffect(()=>{if(e){const E=c().controls;return y({controls:M}),()=>y({controls:E})}},[e,M]),m.createElement("primitive",Z({ref:n,object:M,enableDamping:a},g))}),Ie=At>=154?"opaque_fragment":"output_fragment";class on extends lr{constructor(t){super(t),this.onBeforeCompile=(r,i)=>{const{isWebGL2:a}=i.capabilities;r.fragmentShader=r.fragmentShader.replace(`#include <${Ie}>`,`
        ${a?`#include <${Ie}>`:`#extension GL_OES_standard_derivatives : enable
#include <${Ie}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${At>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const xn=m.forwardRef((e,t)=>{const[r]=m.useState(()=>new on(null));return m.createElement("primitive",Z({},e,{object:r,ref:t,attach:"material"}))}),Rn=m.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:i=1,floatIntensity:a=1,floatingRange:l=[-.1,.1],...h},v)=>{const s=m.useRef(null),g=m.useRef(Math.random()*1e4);return ge(n=>{var o,u;if(!t||r===0)return;const d=g.current+n.clock.getElapsedTime();s.current.rotation.x=Math.cos(d/4*r)/8*i,s.current.rotation.y=Math.sin(d/4*r)/8*i,s.current.rotation.z=Math.sin(d/4*r)/20*i;let p=Math.sin(d/4*r)/10;p=cr.mapLinear(p,-.1,.1,(o=l==null?void 0:l[0])!==null&&o!==void 0?o:-.1,(u=l==null?void 0:l[1])!==null&&u!==void 0?u:.1),s.current.position.y=p*a,s.current.updateMatrix()}),m.createElement("group",h,m.createElement("group",{ref:qe([s,v]),matrixAutoUpdate:!1},e))});let ne,ve;const sn=m.createContext(null),ut=new ur,ft=new q,an=m.forwardRef(({children:e,range:t,limit:r=1e3,...i},a)=>{const l=m.useRef(null),[h,v]=m.useState([]),[[s,g,n]]=m.useState(()=>[new Float32Array(r*3),Float32Array.from({length:r*3},()=>1),Float32Array.from({length:r},()=>1)]);m.useEffect(()=>{l.current.geometry.attributes.position.needsUpdate=!0}),ge(()=>{for(l.current.updateMatrix(),l.current.updateMatrixWorld(),ut.copy(l.current.matrixWorld).invert(),l.current.geometry.drawRange.count=Math.min(r,t!==void 0?t:r,h.length),ne=0;ne<h.length;ne++)ve=h[ne].current,ve.getWorldPosition(ft).applyMatrix4(ut),ft.toArray(s,ne*3),l.current.geometry.attributes.position.needsUpdate=!0,ve.matrixWorldNeedsUpdate=!0,ve.color.toArray(g,ne*3),l.current.geometry.attributes.color.needsUpdate=!0,n.set([ve.size],ne),l.current.geometry.attributes.size.needsUpdate=!0});const o=m.useMemo(()=>({getParent:()=>l,subscribe:u=>(v(d=>[...d,u]),()=>v(d=>d.filter(p=>p.current!==u.current)))}),[]);return m.createElement("points",Z({userData:{instances:h},matrixAutoUpdate:!1,ref:qe([a,l]),raycast:()=>null},i),m.createElement("bufferGeometry",null,m.createElement("bufferAttribute",{attach:"attributes-position",count:s.length/3,array:s,itemSize:3,usage:ce}),m.createElement("bufferAttribute",{attach:"attributes-color",count:g.length/3,array:g,itemSize:3,usage:ce}),m.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:ce})),m.createElement(sn.Provider,{value:o},e))}),ln=m.forwardRef(({children:e,positions:t,colors:r,sizes:i,stride:a=3,...l},h)=>{const v=m.useRef(null);return ge(()=>{const s=v.current.geometry.attributes;s.position.needsUpdate=!0,r&&(s.color.needsUpdate=!0),i&&(s.size.needsUpdate=!0)}),m.createElement("points",Z({ref:qe([h,v])},l),m.createElement("bufferGeometry",null,m.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/a,array:t,itemSize:a,usage:ce}),r&&m.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/a,array:r,itemSize:3,usage:ce}),i&&m.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/a,array:i,itemSize:1,usage:ce})),e)}),On=m.forwardRef((e,t)=>e.positions instanceof Float32Array?m.createElement(ln,Z({},e,{ref:t})):m.createElement(an,Z({},e,{ref:t})));function Tn({all:e,scene:t,camera:r}){const i=U(({gl:h})=>h),a=U(({camera:h})=>h),l=U(({scene:h})=>h);return m.useLayoutEffect(()=>{const h=[];e&&(t||l).traverse(g=>{g.visible===!1&&(h.push(g),g.visible=!0)}),i.compile(t||l,r||a);const v=new fr(128);new dr(.01,1e5,v).update(i,t||l),v.dispose(),h.forEach(g=>g.visible=!1)},[]),null}export{En as C,Cn as D,Rn as F,Pn as H,Sn as O,Tn as P,_n as a,Ye as b,Tt as c,ge as d,On as e,xn as f,wn as g,Mn as u};
